<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Connection Test - Youth Green Jobs Hub</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2d5a27;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #218838;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .loading {
            color: #6c757d;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå± Youth Green Jobs Hub - API Connection Test</h1>
        
        <div class="test-section">
            <h3>Configuration Test</h3>
            <div id="config-result"></div>
        </div>

        <div class="test-section">
            <h3>Backend Connection Test</h3>
            <button onclick="testBackendConnection()">Test Backend API</button>
            <div id="backend-result"></div>
        </div>

        <div class="test-section">
            <h3>CORS Test</h3>
            <button onclick="testCORS()">Test CORS Configuration</button>
            <div id="cors-result"></div>
        </div>

        <div class="test-section">
            <h3>API Endpoints Test</h3>
            <button onclick="testAPIEndpoints()">Test API Endpoints</button>
            <div id="endpoints-result"></div>
        </div>

        <div class="test-section">
            <h3>Frontend Configuration</h3>
            <button onclick="testFrontendConfig()">Test Frontend Config</button>
            <div id="frontend-config-result"></div>
        </div>
    </div>

    <script>
        // Configuration (simulating frontend config)
        const API_CONFIG = {
            BASE_URL: 'http://localhost:8000',
            VERSION: 'v1',
            TIMEOUT_MS: 30000,
            get FULL_BASE_URL() {
                return `${this.BASE_URL}/api/${this.VERSION}`;
            }
        };

        function displayResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = message;
            element.appendChild(resultDiv);
        }

        function clearResults(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        // Test configuration
        function testConfiguration() {
            clearResults('config-result');
            
            displayResult('config-result', `
                <strong>Frontend Configuration:</strong><br>
                ‚Ä¢ Base URL: ${API_CONFIG.BASE_URL}<br>
                ‚Ä¢ API Version: ${API_CONFIG.VERSION}<br>
                ‚Ä¢ Full API URL: ${API_CONFIG.FULL_BASE_URL}<br>
                ‚Ä¢ Timeout: ${API_CONFIG.TIMEOUT_MS}ms
            `, 'info');
        }

        // Test backend connection
        async function testBackendConnection() {
            clearResults('backend-result');
            displayResult('backend-result', 'üîÑ Testing backend connection...', 'loading');

            try {
                const response = await fetch(`${API_CONFIG.FULL_BASE_URL}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {
                    const data = await response.json();
                    displayResult('backend-result', `
                        ‚úÖ <strong>Backend Connection Successful!</strong><br>
                        ‚Ä¢ Status: ${response.status} ${response.statusText}<br>
                        ‚Ä¢ Platform: ${data.message}<br>
                        ‚Ä¢ Version: ${data.version}<br>
                        ‚Ä¢ Available Endpoints: ${Object.keys(data.endpoints).join(', ')}
                    `, 'success');
                } else {
                    displayResult('backend-result', `
                        ‚ùå <strong>Backend Connection Failed</strong><br>
                        ‚Ä¢ Status: ${response.status} ${response.statusText}
                    `, 'error');
                }
            } catch (error) {
                displayResult('backend-result', `
                    ‚ùå <strong>Backend Connection Error</strong><br>
                    ‚Ä¢ Error: ${error.message}<br>
                    ‚Ä¢ Make sure the Django server is running on port 8000
                `, 'error');
            }
        }

        // Test CORS
        async function testCORS() {
            clearResults('cors-result');
            displayResult('cors-result', 'üîÑ Testing CORS configuration...', 'loading');

            try {
                const response = await fetch(`${API_CONFIG.FULL_BASE_URL}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': window.location.origin,
                    },
                });

                if (response.ok) {
                    displayResult('cors-result', `
                        ‚úÖ <strong>CORS Configuration Working!</strong><br>
                        ‚Ä¢ Cross-origin requests are allowed<br>
                        ‚Ä¢ Frontend can communicate with backend<br>
                        ‚Ä¢ Status: ${response.status} ${response.statusText}
                    `, 'success');
                } else {
                    displayResult('cors-result', `
                        ‚ö†Ô∏è <strong>CORS Response Issue</strong><br>
                        ‚Ä¢ Status: ${response.status} ${response.statusText}<br>
                        ‚Ä¢ Check CORS configuration in Django settings
                    `, 'error');
                }
            } catch (error) {
                if (error.message.includes('CORS')) {
                    displayResult('cors-result', `
                        ‚ùå <strong>CORS Error</strong><br>
                        ‚Ä¢ Error: ${error.message}<br>
                        ‚Ä¢ Check CORS_ALLOWED_ORIGINS in Django settings
                    `, 'error');
                } else {
                    displayResult('cors-result', `
                        ‚ùå <strong>Network Error</strong><br>
                        ‚Ä¢ Error: ${error.message}
                    `, 'error');
                }
            }
        }

        // Test API endpoints
        async function testAPIEndpoints() {
            clearResults('endpoints-result');
            displayResult('endpoints-result', 'üîÑ Testing API endpoints...', 'loading');

            const endpoints = [
                { path: '/', name: 'API Root', expectAuth: false },
                { path: '/auth/register/', name: 'User Registration', expectAuth: false, method: 'POST' },
                { path: '/waste/categories/', name: 'Waste Categories', expectAuth: true },
                { path: '/products/categories/', name: 'Product Categories', expectAuth: true }
            ];

            let results = '<strong>API Endpoints Test Results:</strong><br><br>';

            for (const endpoint of endpoints) {
                try {
                    const method = endpoint.method || 'GET';
                    const response = await fetch(`${API_CONFIG.FULL_BASE_URL}${endpoint.path}`, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        results += `‚úÖ ${endpoint.name}: ${response.status} OK<br>`;
                    } else if (response.status === 401 && endpoint.expectAuth) {
                        results += `üîê ${endpoint.name}: ${response.status} (Auth Required - Expected)<br>`;
                    } else if (response.status === 405 && method === 'GET') {
                        results += `üìù ${endpoint.name}: ${response.status} (Method Not Allowed - Expected)<br>`;
                    } else {
                        results += `‚ö†Ô∏è ${endpoint.name}: ${response.status} ${response.statusText}<br>`;
                    }
                } catch (error) {
                    results += `‚ùå ${endpoint.name}: ${error.message}<br>`;
                }
            }

            displayResult('endpoints-result', results, 'info');
        }

        // Test frontend configuration
        function testFrontendConfig() {
            clearResults('frontend-config-result');
            
            const config = {
                'Current URL': window.location.href,
                'Origin': window.location.origin,
                'User Agent': navigator.userAgent.substring(0, 50) + '...',
                'Local Storage Available': typeof(Storage) !== "undefined",
                'Fetch API Available': typeof(fetch) !== "undefined",
                'JSON Support': typeof(JSON) !== "undefined"
            };

            let configHtml = '<strong>Frontend Environment:</strong><br><br>';
            Object.entries(config).forEach(([key, value]) => {
                configHtml += `‚Ä¢ ${key}: ${value}<br>`;
            });

            displayResult('frontend-config-result', configHtml, 'info');
        }

        // Run configuration test on page load
        window.onload = function() {
            testConfiguration();
        };
    </script>
</body>
</html>
